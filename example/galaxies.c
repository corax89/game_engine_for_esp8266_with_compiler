//8x8
char alien11[] = {0xd0,0xd,0x50,0x9,0xd0,0x75,0x5a,0x9,0xd,0x55,0x55,0x90,0x0,0xd5,0x59,0x0,0x0,0x15,0x56,0x0,0x1,0xe5,0x5e,0x60,0x1e,0xd,0x90,0xe6,0xe0,0x0,0x0,0xe};
char alien12[] = {0x0,0xd,0x50,0x0,0xd0,0x75,0x5a,0x9,0xdd,0x55,0x55,0x99,0x0,0xd5,0x59,0x0,0x1,0x15,0x56,0x60,0x1e,0xe5,0x5e,0xe6,0x10,0xd5,0x59,0x6,0xe0,0xd,0x90,0xe};
char alien21[] = {0xf0,0x0,0x0,0xb,0xf0,0x0,0x0,0xb,0xfc,0x0,0x0,0xcb,0xf,0x20,0x2,0xb0,0xf,0xcc,0xcc,0xb0,0x0,0xfc,0xcb,0x0,0xf,0xc,0xc0,0xb0,0xf0,0xf,0xb0,0xb};
char alien22[] = {0xf,0x0,0x0,0xb0,0xf0,0x0,0x0,0xb,0xfc,0x0,0x0,0xcb,0xf,0x20,0x2,0xb0,0xf,0xcc,0xcc,0xb0,0x0,0xfc,0xcb,0x0,0xf,0xf,0xb0,0xb0,0xf,0x0,0x0,0xb0};
//16x16
char ship0[] = {0x0,0x0,0x0,0xa0,0x2,0x0,0x0,0x0,0x0,0x0,0x0,0xa0,0x2,0x0,0x0,0x0,0x0,0x0,0x0,0xa0,0x2,0x0,0x0,0x0,0x0,0x0,0xa,0xf0,0xf,0x20,0x0,0x0,0x0,0x0,0xa,0x1f,0xfc,0x20,0x0,0x0,0x0,0x0,0x1,0xf1,0xcf,0xc0,0x0,0x0,0x0,0x0,0x0,0x1f,0xfc,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0xc0,0x0,0x0,0x0,0x0,0x0,0x0,0x1f,0xfc,0x0,0x0,0x0,0x0,0x0,0x1,0xf3,0x6f,0xc0,0x0,0x0,0xc0,0x0,0x1f,0x13,0x6c,0xfc,0x0,0x9,0xc0,0x1,0xf1,0xf3,0x6f,0xcf,0xc0,0x9,0xc1,0x1f,0x1f,0xf1,0xcf,0xfc,0xfc,0xc9,0xc1,0xf1,0xff,0xf1,0xcf,0xff,0xcf,0xc9,0xcf,0xff,0xff,0xfa,0xaf,0xff,0xff,0xf9,0x70,0x0,0x0,0x0,0x0,0x0,0x0,0x7};
char ship1[] = {0x0,0x0,0x0,0xa0,0x2,0x0,0x0,0x0,0x0,0x0,0x0,0xa0,0x2,0x0,0x0,0x0,0x0,0x0,0x0,0xa0,0x2,0x0,0x0,0x0,0x0,0x0,0xa,0xf0,0xf,0x20,0x0,0x0,0x0,0x0,0xa,0x1f,0xfc,0x20,0x0,0x0,0x0,0x0,0x1,0xf1,0xcf,0xc0,0x0,0x0,0x0,0x0,0x0,0x1f,0xfc,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0xc0,0x0,0x0,0x0,0x0,0x0,0x0,0x1f,0xfc,0x0,0x0,0x0,0x0,0x0,0x1,0xf3,0x6f,0xc0,0x0,0x0,0xc0,0x0,0x1f,0x13,0x6c,0xfc,0x0,0x9,0xc0,0x1,0xf1,0xf3,0x6f,0xcf,0xc0,0x9,0xc1,0x1f,0x1f,0xf1,0xcf,0xfc,0xfc,0xc9,0xc1,0xf1,0xff,0x11,0xf1,0xff,0xcf,0xc9,0xcf,0xff,0xf1,0x72,0x27,0x1f,0xff,0xf9,0x20,0x0,0x0,0x7,0x70,0x0,0x0,0x2};
char shipl[] = {0x0,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x0,0x0,0x0,0xa0,0x20,0x0,0x0,0x0,0x0,0x0,0x0,0xa0,0x20,0x0,0x0,0x0,0x0,0x0,0x0,0xa0,0x22,0x0,0x0,0x0,0x0,0x0,0x0,0xac,0xf2,0xc0,0x0,0x0,0x0,0x0,0x0,0xf1,0xc2,0xc0,0x0,0x0,0x0,0x0,0x0,0x1c,0xfc,0x0,0x0,0x0,0x0,0x0,0x0,0xf1,0xc0,0x0,0x0,0x90,0x0,0x0,0x0,0xf,0xfc,0xf0,0x0,0x99,0x0,0x0,0x0,0x16,0x6f,0xcf,0xc0,0x99,0x0,0x0,0x1,0xf6,0x6f,0xfc,0xfc,0x99,0x0,0x0,0x1f,0x16,0x6f,0xff,0xcf,0x99,0x0,0x1,0xf1,0xf8,0xcf,0xff,0xfc,0x99,0xc0,0x1f,0x1f,0xf7,0x7f,0xf0,0x0,0xaa,0xc1,0xf1,0xf0,0x7,0x70,0x0,0x0,0x0,0x70,0x0,0x0,0x0,0x0,0x0,0x0,0x0};
char shipr[] = {0x0,0x0,0x0,0xa,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xa,0x2,0x0,0x0,0x0,0x0,0x0,0x0,0xa,0x2,0x0,0x0,0x0,0x0,0x0,0x0,0xaa,0x2,0x0,0x0,0x0,0x0,0x0,0x1,0xaf,0x12,0x0,0x0,0x0,0x0,0x0,0x1,0xa1,0xcf,0x0,0x0,0x0,0x0,0x0,0x0,0x1f,0x1c,0x0,0x0,0x0,0xc,0x0,0x0,0x1,0xcf,0x0,0x0,0x0,0xcc,0x0,0xf,0x1f,0x10,0x0,0x0,0x0,0xcc,0x1,0xf1,0xf3,0x39,0x0,0x0,0x0,0xcc,0x1f,0x1f,0xf3,0x3f,0x90,0x0,0x0,0xcc,0xf1,0xff,0xf3,0x3c,0xf9,0x0,0x0,0xcc,0x1f,0xff,0xf1,0xcf,0xcf,0x90,0x0,0x77,0x0,0xf,0xf7,0x7f,0xfc,0xf9,0x9,0x0,0x0,0x0,0x7,0x70,0xf,0xcf,0x99,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xa};
int ship[] = {ship0,ship1};
//2x8
char laser[] = {0x7a,0x7a,0x7a,0x7a,0x7a,0x7a,0x7a,0x7a};
//4x4
char bomb[] = {0x1,0x10,0x13,0x1f,0x11,0xff,0xf,0xf0};
int aliens[] = {alien11, alien12, alien21, alien22};

int i,x,y,cadr,count,key,r,speed,level,game;

void onExit(int n){
	spritesetvalue(n,S_SPEEDX,spritegetvalue(n,S_SPEEDX) * (-1));
	spritesetvalue(n,S_Y,spritegetvalue(n,S_Y) + 9);
}

void flyOnExit(){
	spritesetvalue(29,S_LIVES, 0);
	spritesetvalue(r,S_LIVES, 1);
	spritesetvalue(r,S_Y, 48);
}

void laserExit(){
	spritesetvalue(30,S_LIVES,0);
}

void laserCollision(){
	i = spritegetvalue(30, S_COLLISION);
	spritesetvalue(i, S_LIVES, 0);
	spritesetvalue(30, S_LIVES, 0);
	if(i != 28)
		count--;
}

void shipOnCollision(){
	game = 0;
	spritesetvalue(31, S_LIVES, 0);
}

void nextLevel(){
	for(i = 0; i < 32; i++)
		spritesetvalue(i, S_LIVES, 0);
	level++;
	speed = level - 1;
	gotoxy(7,7);
	setcolor(1);
	printf("level %d", level);
	settimer(0, 1000);
	while(gettimer(0)){}
	clearscreen();
	for(i = 0; i < 30; i++){
		setcolor(random(15));
		putpixel(random(127),random(127));
	}
	i = 0;
	for(y = 0; y < 2; y++)
		for(x = 0; x < 10; x++){
			getsprite(i, alien11);
			spritesetvalue(i,S_SPEEDX,speed);
			spritesetvalue(i,S_SPEEDY,0);
			spritesetvalue(i,S_IS_SCROLLED,0);
			spritesetvalue(i,S_ON_EXIT_SCREEN,onExit);
			putsprite(i, 8 + x * 10, 8 + y * 20);
			i++;
		}
	count = 20;
	x = 48;
	y = 100;
	putsprite(31, x, y);
}

void init(){
	game = 1;
	speed = 0;
	level = 0;
	getsprite(28, bomb);
	spritesetvalue(28,S_WIDTH,4);
	spritesetvalue(28,S_HEIGHT,4);
	spritesetvalue(28,S_SPEEDY,3);
	getsprite(29, alien11);
	spritesetvalue(29,S_SPEEDX,0);
	spritesetvalue(29,S_SPEEDY,0); 
	spritesetvalue(29,S_ON_EXIT_SCREEN,flyOnExit);
	getsprite(31, ship);
	spritesetvalue(31,S_HEIGHT,16);
	spritesetvalue(31,S_WIDTH,16);
	spritesetvalue(31,S_ON_COLLISION,shipOnCollision);
	getsprite(30, laser);
	spritesetvalue(30,S_WIDTH,2);
	spritesetvalue(30,S_SPEEDY,-24);
	spritesetvalue(30,S_ON_EXIT_SCREEN,laserExit);
	spritesetvalue(30,S_ON_COLLISION,laserCollision);
	nextLevel();
}

void nextCadr(){
	if(gettimer(0) == 0){
		settimer(0, 300);
		cadr = 1 - cadr;
		for(i = 0; i < 20; i++)
			getsprite(i, aliens[cadr + (i / 10)*2]);
	}
}

void main(){
	while(1){
	init();
	while(game){
		nextCadr();
		scroll(3);
		getsprite(31, ship[cadr]);
		key = getkey();
			if(key & KEY_B > 0 || key & KEY_A > 0){
				if(spritegetvalue(30,S_LIVES) == 0)
					putsprite(30, x + 7, y - 9);
			}
			if(key & KEY_LEFT && x > 0){
				x-=2;
				getsprite(31, shipl);
			}
			if(key & KEY_RIGHT && x < 112){
				x+=2;
				getsprite(31, shipr);
			}
		putsprite(31, x, y);
		if(random(30) == 1){
			if(spritegetvalue(29,S_LIVES) == 0){
				r = random(10);
				if(spritegetvalue(r,S_LIVES) != 0){
					spritesetvalue(r,S_LIVES, 0);
					if(spritegetvalue(r,S_X) < 60)
						spritesetvalue(29,S_SPEEDX,3);
					else
						spritesetvalue(29,S_SPEEDX,-3);
					putsprite(29, spritegetvalue(r,S_X), spritegetvalue(r,S_Y));
					putsprite(28, spritegetvalue(r,S_X) + 2, spritegetvalue(r,S_Y) + 8);
				}
			}
		}
		if(count <= 0)
			nextLevel();
		delayredraw();
	}
	}
}
